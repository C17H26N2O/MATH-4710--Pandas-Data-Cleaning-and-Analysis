## **Pandas 数据分析练习：北美市场客户分析**

### **练习背景**
你是同一家全球电商公司的数据分析师。在完成欧洲市场分析后，公司CEO对你的工作非常满意。现在她有了新的需求：

"我们需要了解**北美市场**（USA和Canada）的客户购买行为。具体来说：
1. 在北美市场，哪个**产品类别**的**客户复购率**最高？（复购率 = 购买超过1次的客户数 / 总客户数）
2. 找出北美市场的**VIP客户**（累计购买金额超过$500的客户），并分析他们最喜欢的产品类别。"

### **练习任务**

请按照以下步骤完成数据分析任务：

#### **Part 1: 数据加载与检视**
1. 加载三个数据文件：
   - `sales_records.csv`
   - `product_info.xlsx`（sheet名称：'ProductDetails'）
   - `customer_details.json`
2. 使用 `.head()`、`.info()` 和 `.describe()` 检查每个数据集
3. 统计每个数据集的缺失值数量和百分比

#### **Part 2: 数据清洗**
1. 处理 `sales_records` 中的缺失值：
   - `discount`列：用 0 填充
   - `region`列：用 'Unknown' 填充
   - `list_price`列：用该列的**中位数**填充
2. 标准化数据格式：
   - 将 `region` 列统一为小写，并将 'us'、'usa' 统一为 'north_america'
   - 将 'ca'、'canada' 统一为 'north_america'
   - 将 `status` 列标准化（参考视频中的映射方法）
   - 将所有 `product_id` 统一为小写
3. 检查并删除重复行

#### **Part 3: 特征工程**
1. 创建 `final_sales` 列：`final_sales = quantity × list_price × (1 - discount)`
2. 创建 `order_month` 列：从 `sale_date` 中提取月份（提示：先转换为datetime）
3. 创建 `is_discounted` 列：如果 `discount > 0` 则为 True，否则为 False

#### **Part 4: 数据筛选**
1. 筛选出北美市场的数据（region == 'north_america'）
2. 只保留有效订单（status为 'Shipped' 或 'Pending'）
3. 创建两个子集：
   - `usa_sales`：customer country 为 'USA' 的订单
   - `canada_sales`：customer country 为 'Canada' 的订单

#### **Part 5: 数据排序**
1. 找出北美市场销售额最高的前10笔交易
2. 按客户ID和销售日期进行多级排序
3. 找出最近的10笔交易（按日期降序）

#### **Part 6: 数据合并**
1. 将筛选后的北美销售数据与产品数据进行左连接
2. 将结果与客户数据进行左连接，创建完整数据集
3. 检查合并后是否有信息缺失，并报告缺失情况

#### **Part 7: 分组与聚合分析**

**任务 7.1：国家分析**
- 计算USA和Canada各自的：
  - 总销售额
  - 订单数量
  - 平均折扣率

**任务 7.2：客户复购率分析**
- 计算每个产品类别的客户复购率
- 复购率 = 购买超过1次的客户数 / 该类别总客户数
  (提示：使用 `groupby` 和 `nunique()` 方法)

**任务 7.3：VIP客户分析**
- 识别累计购买金额超过$500的VIP客户
- 分析VIP客户最常购买的产品类别（按购买次数）
- 
### **提示**
1. 仔细检查数据类型转换，特别是日期列
2. 在计算复购率时，先计算每个客户的购买次数
3. 使用 `.copy()` 避免链式赋值警告
4. VIP客户分析需要先对客户进行分组聚合，再筛选
5. 记得验证你的中间结果，确保数据处理正确

### **提交要求**
请将你的代码保存在一个名为 `pandas_exercise_solution.py` 的文件中。代码应该包含：
1. 每个Part的输出结果
2. 最终回答三个业务问题的明确答案
